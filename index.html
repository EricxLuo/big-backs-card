<!DOCTYPE html>
<html>
<head>
    <title>Upload Person</title>
    <style>
        body { font-family: Arial; text-align: center; margin-top: 50px; }
        input, button { margin: 10px; }
    </style>
</head>
<body>
    <h1>Upload a Person</h1>
    <input type="text" id="name" placeholder="Name" required><br>
    <input type="file" id="file" accept="image/*" required><br>
    <button onclick="upload()">Upload</button>

    <h2>Generated QR Code:</h2>
    <div id="qr-container"></div>

    <script>
        async function upload() {
            const name = document.getElementById('name').value;
            const file = document.getElementById('file').files[0];

            if (!name || !file) {
                alert("Please provide a name and image!");
                return;
            }

            const reader = new FileReader();
            reader.onload = async () => {
                const base64 = reader.result.split(',')[1];

                try {
                    const res = await fetch('https://2tc6xpubpf.execute-api.us-east-1.amazonaws.com/prod/upload-person', {
                        method: 'POST',
                        body: JSON.stringify({ name, image_base64: base64 }),
                        headers: { 'Content-Type': 'application/json' }
                    });

                    if (!res.ok) throw new Error(`Error: ${res.statusText}`);

                    const data = await res.json();

                    // Show QR code
                    const qrContainer = document.getElementById('qr-container');
                    qrContainer.innerHTML = ''; // clear previous
                    const img = document.createElement('img');
                    img.src = 'data:image/png;base64,' + data.qr_base64;
                    img.width = 250;
                    qrContainer.appendChild(img);

                    alert(`Upload successful! Scan QR to view ${data.name}`);
                } catch (err) {
                    console.error(err);
                    alert("Upload failed. Check console for errors.");
                }
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
